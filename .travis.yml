language: python
python: 2.7
sudo: false
cache:
  directories:
  - eggs
  - test.plone_addon/eggs
matrix:
  fast_finish: true
before_install:
  - virtualenv .
  - bin/pip install --upgrade pip setuptools zc.buildout
install:
  - bin/buildout

env:
  matrix:
    - PLONE_VERSION=      PACKAGE_TYPE=
    - PLONE_VERSION=4.3.10 PACKAGE_TYPE=Basic
    - PLONE_VERSION=4.3.10 PACKAGE_TYPE=Dexterity
    - PLONE_VERSION=4.3.10 PACKAGE_TYPE=Theme
    - PLONE_VERSION=5.0.5 PACKAGE_TYPE=Basic
    - PLONE_VERSION=5.0.5 PACKAGE_TYPE=Dexterity
    - PLONE_VERSION=5.0.5 PACKAGE_TYPE=Theme

install:
  - pip install docutils
  - sed -ie "s/^plone.version.*/plone.version = $PLONE_VERSION/g" test_answers.ini
  - sed -ie "s/^package.type.*/package.type = $PACKAGE_TYPE/g" test_answers.ini
  - if [[ "$PLONE_VERSION" == "" && "$PACKAGE_TYPE" == "" ]]; then sed -ie "s/^plone.version.*//g" test_answers.ini; sed -ie "s/^package.type.*//g" test_answers.ini; fi
  - if [ "$PACKAGE_TYPE" == "Dexterity" ]; then echo "package.dexterity_type_name = MyDexterityTestType" >> test_answers.ini; fi
  - bin/buildout

before_script:
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  - firefox -v

script:
  - bin/check-readme
  - bin/code-analysis
  - bin/test
  - bin/test-plone_addon

after_success:
  - bin/createcoverage
  - pip install coveralls
  - coveralls

after_failure:
  - cat test_answers.ini

notifications:
  email:
    - travis-reports@plone.com
